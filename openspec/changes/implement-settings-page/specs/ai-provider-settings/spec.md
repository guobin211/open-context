# 功能规范：AI 提供商设置

## 概述

AI 提供商设置页面允许用户配置多个 AI 服务提供商（OpenAI、Claude、Azure、智谱AI 等），管理 API 密钥，并调节模型参数。

## 新增需求

### 需求：用户可以添加 AI 提供商

应用**必须**提供添加 AI 提供商功能，用户**必须**能够添加多个 AI 服务提供商（如 OpenAI、Claude、Azure OpenAI、智谱AI 等），并为每个提供商配置 API Key 和相关参数。

#### 场景：用户添加 OpenAI 提供商

**操作步骤**：

1. 用户点击"添加提供商"按钮
2. 在对话框中选择"OpenAI"
3. 输入 API Key
4. 可选：输入自定义 Base URL（代理）
5. 选择可用模型（gpt-4、gpt-3.5-turbo）
6. 点击"保存"

**预期结果**：

- 新提供商出现在提供商列表中
- API Key 加密存储
- 可以在该提供商的模型列表中选择

### 需求：用户可以设置默认提供商

应用**必须**提供设置默认提供商功能，用户**必须**能够指定一个 AI 提供商作为默认使用的提供商。

#### 场景：用户切换默认提供商

**操作步骤**：

1. 用户在提供商卡片上点击"设为默认"

**预期结果**：

- 该提供商标记为默认（显示徽章）
- 应用在调用 AI 时优先使用该提供商

### 需求：用户可以测试提供商连接

应用**必须**提供测试连接功能，用户**必须**能够测试 AI 提供商的 API Key 有效性和连接状态。

#### 场景：用户测试 API Key 有效性

**操作步骤**：

1. 用户在提供商卡片上点击"测试连接"

**预期结果**：

- 系统发送测试请求（如 `/v1/models`）
- 显示"连接成功"或具体错误信息

### 需求：用户可以调节模型参数

应用**必须**提供模型参数调节功能，用户**必须**能够调节 temperature、maxTokens 和 topP 等模型参数。

#### 场景：用户调节 temperature

**操作步骤**：

1. 用户拖动 Temperature 滑块到 0.7

**预期结果**：

- 应用在调用模型时使用 temperature=0.7
- 范围：0.0 - 2.0

## UI 布局

```
┌─────────────────────────────────────────────────┐
│  AI 提供商设置                [添加提供商]        │
├─────────────────────────────────────────────────┤
│                                                 │
│  ┌───────────────────────────────────────────┐ │
│  │ OpenAI                          [默认]     │ │
│  │ gpt-4, gpt-3.5-turbo                      │ │
│  │                                           │ │
│  │ API Key: sk-****************************  │ │
│  │                                           │ │
│  │ [测试连接] [编辑] [删除]                  │ │
│  └───────────────────────────────────────────┘ │
│                                                 │
│  ┌───────────────────────────────────────────┐ │
│  │ Anthropic (Claude)                        │ │
│  │ claude-opus-4, claude-sonnet-4            │ │
│  │                                           │ │
│  │ API Key: sk-****************************  │ │
│  │                                           │ │
│  │ [测试连接] [编辑] [设为默认] [删除]        │ │
│  └───────────────────────────────────────────┘ │
│                                                 │
│  ─────────────────────────────────────────      │
│                                                 │
│  模型参数                                        │
│                                                 │
│  Temperature                                    │
│  ├─────●─────────────────────┤  0.7            │
│  0.0                         2.0                │
│  控制输出的随机性                                 │
│                                                 │
│  Max Tokens                                     │
│  ┌────────────────────────────────────────┐    │
│  │ 4096                                    │    │
│  └────────────────────────────────────────┘    │
│                                                 │
│  Top P                                          │
│  ├─────────●───────────────────┤  0.9          │
│  0.0                           1.0              │
│                                                 │
└─────────────────────────────────────────────────┘
```

## 技术实现

### 类型定义

```typescript
interface AIProviderConfig {
  id: string;
  name: string;
  type: 'openai-compatible' | 'anthropic' | 'azure' | 'custom';
  apiKey: string;
  baseUrl?: string;
  models: string[];
  defaultModel?: string;
  enabled: boolean;
}

interface AIConfig {
  providers: AIProviderConfig[];
  defaultProviderId: string;
  modelParams: {
    temperature: number; // 0.0-2.0
    maxTokens: number;
    topP: number; // 0.0-1.0
  };
}
```

## 数据验证

- API Key 不能为空
- Temperature 范围：0.0-2.0
- Top P 范围：0.0-1.0
- Max Tokens 必须大于 0

## 相关功能

- **聊天功能**：使用配置的 AI 提供商进行对话
- **代码补全**：可能使用特定模型进行代码建议
