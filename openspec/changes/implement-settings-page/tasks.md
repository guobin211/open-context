# 任务清单

本变更将分为以下可验证的工作项，按顺序实施：

## 阶段 1：基础架构和类型定义

### 任务 1.1：扩展类型定义

- [x] 扩展 `lib/app-settings.ts` 中的 `AppConfig` 接口
- [x] 定义所有设置分类的子接口（GeneralConfig、AppearanceConfig 等）
- [x] 定义快捷键相关类型（ShortcutConfig、ShortcutsMap）
- [x] 定义 AI 提供商类型（AIProviderConfig）
- [x] 添加类型导出和文档注释
- **验证**：TypeScript 编译通过，无类型错误 ✅

### 任务 1.2：创建默认配置文件

- [x] 创建 `lib/default-shortcuts.ts`，定义所有默认快捷键
- [x] 创建 `lib/default-settings.ts`，集中管理所有默认配置
- [x] 定义配置版本号和迁移策略
- **验证**：配置文件导入成功，默认值符合预期 ✅

### 任务 1.3：扩展 settings-store

- [x] 重构 `storage/settings-store.ts` 以支持新的配置结构
- [x] 实现 `exportConfig` 方法（导出 JSON）
- [x] 实现 `importConfig` 方法（导入并验证 JSON）
- [x] 添加配置版本迁移逻辑
- [x] 实现部分更新和嵌套更新功能
- **验证**：状态更新正确，持久化正常，导入导出功能正常 ✅

## 阶段 2：通用 UI 组件

### 任务 2.1：创建设置表单基础组件

- [x] 创建 `components/settings/settings-item.tsx`（设置项容器）
- [x] 创建 `components/settings/settings-section.tsx`（设置分组）
- [x] 创建 `components/settings/settings-actions.tsx`（操作按钮组）
- **验证**：组件渲染正常，样式符合设计 ✅

### 任务 2.2：重构 SettingsLayout

- [x] 从 `settings-layout.tsx` 中抽取 `settings-menu.tsx`
- [x] 优化布局组件的响应式设计
- [ ] 添加平滑的页面切换动画（可选）
- **验证**：菜单和布局功能正常，无样式错误 ✅

## 阶段 3：实现各设置页面（按复杂度递增）

### 任务 3.1：通用设置（扩展现有）

- [x] 扩展 `general-settings.tsx`，添加以下配置项：
  - 语言选择（已有，验证功能）
  - 自动更新开关
  - 开机启动开关
  - 最小化到托盘开关
- [x] 添加国际化支持
- [x] 连接到 settings-store
- **验证**：所有配置项可正常读取和保存 ✅

### 任务 3.2：外观设置

- [x] 创建 `appearance-settings.tsx`
- [x] 实现主题选择（Light / Dark / System）
- [x] 实现字体大小调节（滑块 + 数字输入）
- [x] 实现编辑器主题选择
- [x] 实现 UI 缩放调节
- [ ] 添加实时预览效果（可选）
- **验证**：设置变更立即反映在界面上（或提示需要重启） ✅

### 任务 3.3：数据存储设置

- [x] 创建 `storage-settings.tsx`
- [x] 实现本地存储路径选择（文件选择器）
- [x] 实现最大缓存大小配置
- [x] 实现自动清理开关
- [x] 实现备份配置（启用、路径选择）
- [x] 显示当前存储使用情况（文件大小、数量）
- **验证**：路径选择正常，存储信息显示准确 ✅

### 任务 3.4：服务器设置

- [x] 创建 `server-settings.tsx`
- [x] 实现 Open-Node 服务配置（URL、端口）
- [x] 实现自动启动服务器开关
- [x] 实现 MCP 服务开关
- [x] 实现 HTTP API 开关
- [x] 添加"测试连接"按钮
- [x] 显示服务状态指示器
- **验证**：服务配置正确保存，测试连接功能正常 ✅

### 任务 3.5：云存储设置

- [x] 创建 `cloud-settings.tsx`
- [x] 实现云存储总开关
- [x] 实现提供商选择（COS / S3 / OSS）
- [x] 实现 COS 配置表单（SecretId、SecretKey、Region、Bucket）
- [x] 实现区域选择下拉菜单（腾讯云区域列表）
- [x] 实现同步策略选择（自动 / 手动 / 仅 WiFi）
- [x] 添加"测试连接"按钮
- [x] 显示存储空间信息（需要 API 支持，可占位）
- [x] 实现敏感信息遮罩显示
- **验证**：配置保存正确，敏感信息不明文显示 ✅

### 任务 3.6：AI 提供商设置

- [x] 创建 `ai-provider-settings.tsx`
- [x] 实现 AI 提供商列表（卡片展示）
- [x] 实现"添加提供商"对话框
- [x] 实现提供商编辑功能
- [x] 实现提供商删除功能（带确认）
- [x] 实现默认提供商选择
- [x] 实现模型参数调节（temperature、maxTokens、topP）
- [x] 添加"测试连接"按钮
- [x] 实现敏感信息遮罩显示
- **验证**：提供商 CRUD 正常，测试连接功能正常 ✅

### 任务 3.7：快捷键设置

- [x] 创建 `shortcuts-settings.tsx`
- [x] 创建 `keyboard-input.tsx` 组件（快捷键输入框）
- [x] 实现快捷键列表（按分类分组）
- [x] 实现快捷键编辑功能
- [x] 实现快捷键冲突检测
- [x] 实现冲突解决对话框
- [x] 实现"重置为默认"功能（单个和全部）
- [x] 实现快捷键搜索/过滤
- [ ] 实现预设方案切换（VS Code 风格 / Vim 风格等，可选）
- **验证**：快捷键录制正常，冲突检测准确，保存和重置功能正常 ✅

## 阶段 4：国际化

### 任务 4.1：添加翻译文件

- [x] 创建 `i18n/locales/zh-CN/settings.json`
- [x] 创建 `i18n/locales/en/settings.json`
- [x] 添加其他语言翻译（zh-TW、ja、ko）
- **验证**：所有语言的翻译文件完整无遗漏 ✅

### 任务 4.2：替换硬编码文本

- [x] 替换所有设置页面的硬编码文本为 i18n 调用
- [x] 验证语言切换功能
- **验证**：切换语言后所有文本正确显示 ✅

## 阶段 5：集成和优化

### 任务 5.1：集成到设置路由

- [x] 更新 `routes/settings/index.tsx`，使用 `SettingsLayout`
- [x] 移除所有占位组件
- [x] 验证路由切换正常
- **验证**：从应用其他页面进入设置页面正常 ✅

### 任务 5.2：添加配置导入导出功能

- [x] 在通用设置或单独页面添加"导入配置"按钮
- [x] 添加"导出配置"按钮
- [x] 实现文件选择和读取逻辑
- [x] 实现配置验证和错误提示
- **验证**：导入导出功能正常，错误处理完善 ✅

### 任务 5.3：性能优化

- [x] 使用 React.lazy 延迟加载各设置页面
- [x] 实现设置保存防抖（500ms）
- [ ] 优化快捷键列表渲染（虚拟滚动，可选）
- **验证**：页面切换流畅，无卡顿 ✅

### 任务 5.4：代码质量检查

- [x] 运行 `pnpm lint:js` 并修复所有 lint 错误
- [x] 运行 `pnpm fmt:js` 格式化代码
- [x] 检查所有 TypeScript 类型定义
- [x] 移除所有 console.log 调试代码
- **验证**：代码通过所有检查，无警告和错误 ✅

## 依赖关系

- 任务 1.1 → 任务 1.2 → 任务 1.3（必须顺序执行）
- 任务 2.1 → 任务 3.x（基础组件完成后才能实现各设置页面）
- 任务 3.1 - 3.7 可以部分并行（但建议按复杂度递增顺序）
- 任务 4.x 依赖所有任务 3.x 完成
- 任务 5.x 依赖所有前置任务完成

## 验证清单

### 功能验证

- [ ] 所有设置项都可以正确读取和保存
- [ ] 设置变更后刷新页面，配置仍然保留
- [ ] 敏感信息（API Key）不会明文显示
- [ ] 快捷键冲突检测准确
- [ ] 导入导出配置功能正常
- [ ] 语言切换功能正常

### UI/UX 验证

- [ ] 所有页面在不同分辨率下正常显示
- [ ] 表单控件对齐整齐，间距合理
- [ ] 错误提示清晰易懂
- [ ] 按钮状态正确（禁用 / 加载中）
- [ ] 无明显的性能问题或卡顿

### 代码质量验证

- [ ] 无 TypeScript 类型错误
- [ ] 无 ESLint 警告或错误
- [ ] 代码遵循项目命名和风格约定
- [ ] 无未使用的导入和变量
- [ ] 组件代码行数不超过 1000 行

## 时间估算

不提供具体时间估算，任务按优先级和依赖关系顺序执行。
