## 新增需求

### 需求：统一日志 API 设计

系统必须提供跨三端（open-app Rust、open-node Node.js、open-web React）的一致性日志 API，确保日志接口和参数结构保持统一。

#### 场景：日志 API 一致性

- **当** 开发者在不同端调用日志函数
- **那么** 日志函数名称必须保持一致（log/info/warn/error）
- **并且** 日志参数结构必须保持一致（支持字符串、对象、混合参数）
- **并且** 日志级别命名必须保持一致（trace/debug/info/warn/error）

### 需求：日志文件管理

系统必须将日志输出到 `~/.open-context/logs/` 目录，按端分目录存储（open-app、open-node、open-web），每个端必须按天生成日志文件，并必须自动清理7天前的日志文件。

#### 场景：日志文件按天分文件

- **当** 系统在 2026-01-27 运行并产生日志
- **那么** 日志文件必须命名为 `open-app-2026-01-27.log`、`open-node-2026-01-27.log`、`open-web-2026-01-27.log`
- **并且** 所有日志必须按天归档到对应的文件中

#### 场景：自动清理旧日志

- **当** 日志目录中存在超过7天的日志文件
- **那么** 系统必须自动删除7天前的日志文件
- **并且** 必须仅保留最近7天的日志文件

### 需求：开发/生产环境差异

系统必须根据运行环境自动配置日志输出目标：开发环境必须输出到控制台（便于调试），生产环境必须输出到日志文件（便于运维）。

#### 场景：开发环境日志输出

- **当** 系统在开发环境运行（NODE_ENV=development 或构建模式为 debug）
- **那么** 日志必须同时输出到控制台和日志文件
- **并且** 控制台输出必须包含彩色格式化信息

#### 场景：生产环境日志输出

- **当** 系统在生产环境运行（NODE_ENV=production 或构建模式为 release）
- **那么** 日志必须仅输出到日志文件
- **并且** 控制台禁止输出任何日志信息

### 需求：日志级别控制

系统必须支持通过环境变量 `LOG_LEVEL` 配置日志级别，低于配置级别的日志必须被过滤掉。

#### 场景：日志级别过滤

- **当** 设置 `LOG_LEVEL=info`
- **那么** info、warn、error 级别的日志必须输出
- **并且** trace、debug 级别的日志必须被过滤

#### 场景：默认日志级别

- **当** 未设置 `LOG_LEVEL` 环境变量
- **那么** 开发环境必须默认使用 `debug` 级别
- **并且** 生产环境必须默认使用 `info` 级别

### 需求：日志格式一致性

系统必须确保三端的日志格式保持一致，包含时间戳、日志级别、模块名称和消息内容，便于日志聚合和查询。

#### 场景：统一日志格式

- **当** 三端产生日志时
- **那么** 日志格式必须包含：`[时间戳] [级别] [模块名] 消息内容`
- **并且** 时间戳必须使用 ISO 8601 格式（`2026-01-27T14:56:03.000Z`）

### 需求：Node.js 端日志实现

open-node 端必须使用 pino 库实现日志功能，必须支持高性能结构化日志、文件输出和日志轮转。

#### 场景：pino 日志输出

- **当** open-node 端调用 logger.info({ id: '123' }, 'Message')
- **那么** pino 必须输出结构化 JSON 日志到文件
- **并且** 日志必须包含 id 字段和消息内容

#### 场景：pino 日志轮转

- **当** open-node 端日志输出时
- **那么** pino 必须自动按天创建新日志文件
- **并且** pino 必须自动清理7天前的日志文件

### 需求：Web 端日志实现

open-web 端必须使用 tauri-plugin-log 库实现日志功能，必须通过 Tauri IPC 调用 Rust 端日志系统，实现跨平台文件日志。

#### 场景：tauri-plugin-log 调用

- **当** open-web 端调用 logger.info('Message')
- **那么** 日志必须通过 Tauri IPC 传递到 Rust 端
- **并且** Rust 端必须将日志写入对应的日志文件

#### 场景：Web 端日志级别同步

- **当** Web 端设置日志级别
- **那么** 必须通过 Tauri IPC 同步日志级别配置到 Rust 端
- **并且** 所有日志调用都必须应用新的日志级别

### 需求：Rust 端日志实现

open-app Rust 端必须增强现有 log crate 实现，必须添加文件轮转、配置管理和 Tauri 日志插件支持。

#### 场景：Rust 日志文件轮转

- **当** open-app 端产生日志时
- **那么** 日志必须写入按天分文件的日志文件
- **并且** 必须自动清理7天前的日志文件

#### 场景：Tauri 日志插件集成

- **当** Tauri 日志插件接收到来自 Web 端的日志请求
- **那么** 必须将日志写入 open-web 对应的日志文件
- **并且** 必须应用统一的日志格式和级别控制
